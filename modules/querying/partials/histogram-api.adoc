[#_compute_histogram_statistics]
=== Compute histogram statistics

`POST :14240/gsqlserver/gsql/stats/histogram`

This endpoint computes histograms for a specified attribute of a vertex type.

==== Parameters
No URL parameters.
Provide parameters in the request body.

==== Request body

The request body expects a JSON object with the following schema:

[tabs]
====
Vertex attribute::
+
--
----
{
    "graph": <graph_name>,
    "vertex": <vertex_type_name>
    "attribute": <attribute_name>
    "bucket" <bucket_number>
}
----
--
Edge attribute::
+
--
----
{
    "graph": <graph_name>,
    "edge": <edge_type_name>,
    "attribute": <attribute_name>,
    "bucket" <bucket_number>,
    "from`: <source_vertex_type>,
    "to": <target_vertex_type>
}
----
--
====

|===
|Parameter |Description |Data type

|`graph`
|Name of the graph.
|`STRING`


|`vertex`
|Name of the vertex type.
|`STRING`

|`edge`
|Name of the refined edge type.

|`STRING`

|`attribute`
|Name of the attribute.
|`STRING`

|`bucket`
|The number of intervals (https://en.wikipedia.org/wiki/Data_binning[buckets]) to divide the range of attribute values by.

It is recommended that each bucket have at least 100 values.
Therefore, a good rule of thumb is to divide the number of vertices by 100 to decide the number of buckets.
For example, if the vertex type has 100,000 vertices, set this parameter to no higher than 1000.
A standard value for this parameter is 256.
|`INT`

|`from`
|Source vertex type of a refined edge type.
|`STRING`

|`to`
|Target edge type of a refined edge type.
|`STRING`
|===

==== Examples

The following request computes the histogram data for attribute `firstName` of vertex type `Person` on graph `ldbc_snb`:

[.wrap,console]
----
$ curl --user tigergraph:tigergraph -X POST \
"http://localhost:14240/gsqlserver/gsql/stats/histogram" \
-d '{"graph":"ldbc_snb", "vertex":"Person", "attribute":"firstName", "buckets":10}'
----

To compute the histogram data for attribute `creationDate`  from vertex type `Person` to vertex type `Comment`, make the following request:

[.wrap,console]
----
$ curl --user tigergraph:tigergraph -X POST \
"http://localhost:14240/gsqlserver/gsql/stats/histogram" \
-d '{"graph":"ldbc_snb", "edge":"LIKES", "from":"Person", "to":"Comment", "attribute":"creationDate", "buckets":10}'
----

=== Retrieve histogram statistics

`GET :14240/gsqlserver/gsql/stats/histogram`

This endpoint retrieves histogram data for a specified attribute of a vertex type.

==== Parameters

|===
|Parameter |Description |Data type

|`graph`
|Name of the graph.
|`STRING`


|`vertex`
|Name of the vertex type.
|`STRING`

|`edge`
|Name of the refined edge type.
|`STRING`

|`from`
|Source vertex type of a refined edge type.
|`STRING`

|`to`
|Target edge type of a refined edge type.
|`STRING`

|`attribute`
|Name of the attribute.
|`STRING`
|===

==== Examples

The following request retrieves the histogram statistics for the `first_name` attribute of the vertex type `Person`:

[.wrap,console]
----
$ curl -s --user tigergraph:tigergraph -X GET "http://localhost:14240/gsqlserver/gsql/stats/histogram?graph=ldbc_snb&vertex=Person&attribute=firstName"
----

The following request retrieves the histogram statistics for the `creationDate` attribute of the refined edge type `LIKES` between `Person` and `Comment`:

[.wrap,console]
----
$ curl --user tigergraph:tigergraph -X GET "http://localhost:14240/gsqlserver/gsql/stats/histogram?graph=ldbc_snb&edge=LIKES&attribute=creationDate&from=Person&to=Comment"
----

=== Upload histogram statistics

If you have pre-computed histogram for an attribute, you can upload the statistics instead of computing them.

==== Parameters
No query string parameters.
Provide a request body instead.

==== Request body

In the request body, provide the attribute for which the histogram statistics are specific to along with the histogram data itself.

==== Example

For example, you retrieved the histogram data for the `creationDate` attribute data in the following request:

[tabs]
====
Request::
+
--
[.wrap,console]
----
$ curl --user tigergraph:tigergraph -X GET "http://localhost:14240/gsqlserver/gsql/stats/histogram?graph=ldbc_snb&edge=LIKES&attribute=creationDate&from=Person&to=Comment"
----
--
Response::
+
--
[.wrap,json]
----
{
  "error": false,
  "message": "",
  "results": [
    {
      "histogram": [
        {
          "ndv": 1,
          "upperBound": "A",
          "rowsUpper": 1,
          "rowsTotal": 1
        },
        {
          "ndv": 129,
          "upperBound": "Alejandro",
          "rowsUpper": 26,
          "rowsTotal": 786
        },
        {
          "ndv": 124,
          "upperBound": "Arun",
          "rowsUpper": 32,
          "rowsTotal": 769
        },
        {
          "ndv": 123,
          "upperBound": "Chan",
          "rowsUpper": 7,
          "rowsTotal": 769
        },
        {
          "ndv": 142,
          "upperBound": "Ernst",
          "rowsUpper": 15,
          "rowsTotal": 774
        },
        {
          "ndv": 146,
          "upperBound": "Ilias",
          "rowsUpper": 3,
          "rowsTotal": 766
        },
        {
          "ndv": 70,
          "upperBound": "Jozef",
          "rowsUpper": 2,
          "rowsTotal": 766
        },
        {
          "ndv": 101,
          "upperBound": "Manju",
          "rowsUpper": 1,
          "rowsTotal": 765
        },
        {
          "ndv": 137,
          "upperBound": "Peter",
          "rowsUpper": 29,
          "rowsTotal": 793
        },
        {
          "ndv": 120,
          "upperBound": "Taufik",
          "rowsUpper": 19,
          "rowsTotal": 780
        },
        {
          "ndv": 102,
          "upperBound": "พงศธร สุภิญโญ",
          "rowsUpper": 1,
          "rowsTotal": 683
        }
      ]
    }
  ]
}
----
--
====

You can upload the histogram data with the following request:

[.wrap,console]
----
$ curl --user tigergraph:tigergraph -X PUT "http://localhost:14240/gsqlserver/gsql/stats/histogram" \
-d '{"graph":"ldbc_snb", "edge":"LIKES", "from":"Person", "to":"Comment", "attribute":"creationDate", "buckets":10, "histogram": [{"ndv":1,"upperBound":"2010-05-10 22:30:29","rowsUpper":1,"rowsTotal":1},{"ndv":72178,"upperBound":"2012-01-18 18:34:43","rowsUpper":1,"rowsTotal":73171},{"ndv":71842,"upperBound":"2012-04-23 07:25:39","rowsUpper":1,"rowsTotal":73171},{"ndv":71773,"upperBound":"2012-06-16 22:01:27","rowsUpper":1,"rowsTotal":73171},{"ndv":71709,"upperBound":"2012-07-29 09:09:41","rowsUpper":2,"rowsTotal":73172},{"ndv":71615,"upperBound":"2012-08-31 07:27:07","rowsUpper":1,"rowsTotal":73171},{"ndv":71294,"upperBound":"2012-09-24 06:15:18","rowsUpper":1,"rowsTotal":73171},{"ndv":70819,"upperBound":"2012-10-16 11:46:55","rowsUpper":1,"rowsTotal":73171},{"ndv":70903,"upperBound":"2012-11-02 19:24:15","rowsUpper":1,"rowsTotal":73171},{"ndv":70031,"upperBound":"2012-11-17 08:12:27","rowsUpper":1,"rowsTotal":73171},{"ndv":68982,"upperBound":"2012-11-29 02:52:46","rowsUpper":1,"rowsTotal":73169}]}'
----

=== Delete histogram statistics

`DELETE :14240/gsqlserver/gsql/stats/histogram`

This endpoint deletes histogram data for a graph.
This includes histogram data on all vertex attributes in that graph.

==== Parameters

|===
|Parameter |Description |Data type

|`graph`
|Name of the graph.
|`STRING`


|`vertex`
|Name of the vertex type.
|`STRING`

|`edge`
|Name of the refined edge type.
|`STRING`

|`from`
|Source vertex type of a refined edge type.
|`STRING`

|`to`
|Target edge type of a refined edge type.
|`STRING`

|`attribute`
|Name of the attribute.
|`STRING`
|===

==== Examples

The following request deletes the histogram statistics for the graph `ldbc_snb`:

[.wrap,console]
----
curl -s --user tigergraph:tigergraph -X DELETE "http://localhost:14240/gsqlserver/gsql/stats/histogram?graph=ldbc_snb
----

The following request deletes the histogram statistics for the `creationDate` attribute of the refined edge type `LIKES` between `Person` and `Comment`:

[.wrap,console]
----
$ curl --user tigergraph:tigergraph -X DELETE "http://localhost:14240/gsqlserver/gsql/stats/histogram?graph=ldbc_snb&edge=LIKES&attribute=creationDate&from=Person&to=Comment"
----